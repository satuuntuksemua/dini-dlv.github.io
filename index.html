<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>QR Code Scanner</title>
    <script src="https://unpkg.com/@zxing/library@0.18.3"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
      }

      .container {
        max-width: 960px;
        margin: 0 auto;
        padding: 32px;
      }

      h1 {
        text-align: center;
        margin-bottom: 32px;
      }

      #qr-code-video {
        display: block;
        margin: 0 auto;
        max-width: 100%;
        height: auto;
        border: 4px solid #ffffff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      #qr-code-result {
        margin-top: 32px;
        font-size: 24px;
        text-align: center;
        border: 4px solid #ffffff;
        padding: 16px;
      }

      table {
        width: 100%;
        margin-top: 32px;
        border-collapse: collapse;
      }

      th, td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        background-color: #4CAF50;
        color: white;
      }

      .text-center {
        text-align: center;
      }

      .text-danger {
        color: red;
      }
      
      .text-success {
        color: green;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>QR Code Scanner</h1>

      <div>
        <video id="qr-code-video"></video>
      </div>

      <div id="qr-code-result"></div>

      <table id="attendees-table">
        <thead>
          <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Description</th>
            <th>Attended</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <script>
    const codeReader = new ZXing.BrowserQRCodeReader();
const videoElement = document.getElementById('qr-code-video');
const resultElement = document.getElementById('qr-code-result');
const attendanceTable = document.getElementById('attendance-table-body');

let data = []; // Initialize guest data array
let attendance = []; // Initialize attendance data array

// Load guest data from external JSON file
fetch('guest-data.json')
  .then(response => response.json())
  .then(guestData => {
    data = guestData;
  })
  .catch(error => console.error(error));

// Load attendance data from local storage
const localStorageData = localStorage.getItem('attendance');
if (localStorageData) {
  attendance = JSON.parse(localStorageData);
}

// Function to update the attendance table
function updateAttendanceTable() {
  attendanceTable.innerHTML = ''; // Clear previous data

  // Loop through attendance data and append to table
  attendance.forEach(item => {
    const row = attendanceTable.insertRow();

    const codeCell = row.insertCell();
    codeCell.innerText = item.code;

    const nameCell = row.insertCell();
    nameCell.innerText = item.name;

    const descCell = row.insertCell();
    descCell.innerText = item.desc;
  });
}

// Update attendance table on page load
updateAttendanceTable();

// Function to add new attendance item
function addAttendance(code) {
  const attendee = data.find(item => item.code === code); // Get guest data

  // Check if attendee already exists in attendance data
  const existingAttendee = attendance.find(item => item.code === code);
  if (existingAttendee) {
    resultElement.innerText = 'Anda Sudah Scan Sebelumnya!'; // Display message if attendee already exists
    return;
  }

  // Add new attendance item to array and update local storage
  attendance.push({
    code: code,
    name: attendee.name,
    desc: attendee.desc
  });
  localStorage.setItem('attendance', JSON.stringify(attendance));

  // Update attendance table and display success message
  updateAttendanceTable();
  resultElement.innerText = `Selamat datang ${attendee.name} dari ${attendee.desc}, Terima kasih sudah hadir di acara pernikahan Kami!`;

  // Play beep sound
  const audio = new Audio('https://www.soundjay.com/buttons/beep-08b.wav');
  audio.play();
}

// Set up scanner
codeReader.decodeFromVideoDevice(undefined, videoElement, (result, error) => {
  if (result) {
    addAttendance(result.text); // Call addAttendance function on scan
  } else if (error && error.name !== 'NotFoundException') {
    console.error(error);
  }
});

    </script>
  </body>
</html>
