<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>QR Code Scanner</title>
    <script src="https://unpkg.com/@zxing/library@0.18.3"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
      }

      .container {
        max-width: 960px;
        margin: 0 auto;
        padding: 32px;
      }

      h1 {
        text-align: center;
        margin-bottom: 32px;
      }

      #qr-code-video {
        display: block;
        margin: 0 auto;
        max-width: 100%;
        height: auto;
        border: 4px solid #ffffff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      #qr-code-result {
        margin-top: 32px;
        font-size: 24px;
        text-align: center;
        border: 4px solid #ffffff;
        padding: 16px;
      }

      @media screen and (min-width: 480px) {
        #qr-code-video {
          width: 480px;
          height: 480px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>QR Code Scanner</h1>

      <div>
        <video id="qr-code-video"></video>
      </div>

      <div id="qr-code-result"></div>
	<!-- <audio id="beep" src="https://www.soundjay.com/buttons/beep-08b.wav"></audio> -->
    </div>

    <script>
      const xhr = new XMLHttpRequest();
      xhr.open('GET', 'guest-data.json');
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onload = function() {
        if (xhr.status === 200) {
          const data = JSON.parse(xhr.responseText);
          processResult(data);
        }
      };
      xhr.send();

      const codeReader = new ZXing.BrowserQRCodeReader();
      const videoElement = document.getElementById('qr-code-video');
      const resultElement = document.getElementById('qr-code-result');

      // Load JSON data from external file
      fetch('guest-data.json')
        .then(response => response.json())
        .then(data => {
          // Set up scanner
          codeReader.decodeFromVideoDevice(undefined, videoElement, (result, error) => {
            if (result) {
              // Check if scanned code exists in the JSON data
              const attendee = data.find(item => item.code === result.text);
              if (attendee) {
                // Display message if code exists
                resultElement.innerText = `Selamat datang ${attendee.name} dari ${attendee.desc}, Terima kasih sudah hadir !`;
                // Play beep sound
                const audio = new Audio('https://www.soundjay.com/buttons/beep-08b.wav');
                audio.play();
              } else {
                // Display error message if code not found
                resultElement.innerText = 'QR Kode Salah!!!';
              }
            } else if (error && error.name !== 'NotFoundException') {
              console.error(error);
            }
          });
        })
        .catch(error => console.error(error));
    </script>
  </body>
</html>
